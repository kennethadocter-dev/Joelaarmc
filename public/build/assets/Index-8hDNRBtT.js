import{u as w,r as l,a as d,j as e,H as C,L as m}from"./app-CsPuMaPE.js";import{A as S}from"./AuthenticatedLayout-DLvna0tA.js";import{p as $}from"./printSection-MIQ23R94.js";/* empty css            */import"./transition-Bs_woZCa.js";function A(){const{customers:x=[],counts:n={},filters:p={},flash:o={},auth:h={},basePath:r="admin"}=w().props,g=h?.user||{},[c,y]=l.useState(p?.q||""),[i,v]=l.useState(p?.status||"all"),u=l.useRef(null);l.useEffect(()=>{const t=setTimeout(()=>{d.get(route(`${r}.customers.index`),{q:c||void 0,status:i||void 0},{preserveState:!0,replace:!0})},400);return()=>clearTimeout(t)},[c,i]);const j=(t,a)=>{confirm(a==="active"?"Mark this customer as inactive?":"Reactivate this customer?")&&d.post(route(`${r}.customers.toggleStatus`,t))},b=(t,a,s)=>{if(a==="suspended")confirm("Reactivate this suspended customer?")&&d.post(route(`${r}.customers.toggleStatus`,t));else{if(s){alert("‚ö†Ô∏è Cannot suspend ‚Äî customer has unpaid loans.");return}confirm("Suspend this customer?")&&d.post(route(`${r}.customers.suspend`,t))}},N=()=>{if(!u.current)return alert("‚ö†Ô∏è Nothing to print!");const t=h?.user?.company_name||"Joelaar Micro-Credit Services",a=new Date().toLocaleString(),s=document.createElement("div");s.innerHTML=`
          <div style="text-align:center;margin-bottom:20px;">
            <h2 style="margin:0;">${t}</h2>
            <p style="margin:4px 0;">Customer Records Report</p>
            <p style="margin:4px 0;font-size:12px;color:#555;">Generated on ${a}</p>
            <hr style="margin:10px 0;">
          </div>
          ${u.current.innerHTML}
        `,$(s)},f=["admin","staff","officer","superadmin"].includes(g?.role)||g?.is_super_admin;return e.jsxs(S,{header:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Customers"}),children:[e.jsx(C,{title:"Customers"}),e.jsxs("div",{className:"py-8 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[o?.success&&e.jsx("div",{className:"bg-green-100 text-green-800 px-4 py-2 rounded shadow",children:o.success}),o?.error&&e.jsx("div",{className:"bg-red-100 text-red-800 px-4 py-2 rounded shadow",children:o.error}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[{label:"Active",key:"active",count:n.active??0},{label:"Inactive",key:"inactive",count:n.inactive??0},{label:"Suspended",key:"suspended",count:n.suspended??0},{label:"Total",key:"all",count:n.total??0}].map(({label:t,key:a,count:s})=>e.jsxs("div",{onClick:()=>v(a),className:`stat-card cursor-pointer p-5 rounded-xl text-center font-medium shadow-md transition transform hover:scale-[1.03]
                                bg-gray-800 ${i===a?"ring-2 ring-offset-2 ring-green-400":""}`,children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:t}),e.jsx("p",{className:"text-3xl font-bold mt-1 text-white",children:s})]},a))}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search name / phone / community‚Ä¶",value:c,onChange:t=>y(t.target.value),className:"border border-gray-300 rounded px-3 py-2 w-full md:w-80 bg-white text-gray-900 placeholder-gray-500"}),e.jsxs("select",{value:i,onChange:t=>v(t.target.value),className:"border border-gray-300 rounded px-3 py-2 w-48 bg-white text-gray-900",children:[e.jsx("option",{value:"all",children:"All Customers"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[f&&e.jsx(m,{href:route(`${r}.customers.create`),className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded transition shadow",children:"+ New Customer"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gray-800 text-white rounded hover:bg-black transition shadow",children:"üñ®Ô∏è Print"})]})]}),e.jsx("div",{ref:u,className:"overflow-x-auto bg-white rounded-lg shadow border border-gray-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsx("tr",{children:["Name","Phone","Community","Location","Created","Status","Actions"].map(t=>e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-800",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.length?x.map(t=>{const a=t.loans?.some(s=>s.status!=="paid"&&s.amount_remaining>0);return e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:t.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.phone||"‚Äî"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.community||"‚Äî"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.location||"‚Äî"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold border ${t.status==="active"?"bg-green-100 text-green-700 border-green-400":t.status==="suspended"?"bg-red-100 text-red-700 border-red-400":"bg-gray-200 text-gray-800 border-gray-400"}`,children:t.status})}),e.jsxs("td",{className:"px-4 py-3 text-sm flex flex-wrap gap-3 items-center",children:[e.jsx(m,{href:route(`${r}.customers.show`,t.id),className:"text-blue-600 hover:underline",children:"View"}),f&&e.jsxs(e.Fragment,{children:[e.jsx(m,{href:route(`${r}.loans.create`,{customer_id:t.id,client_name:t.full_name}),className:`${t.loans?.length>=3?"text-gray-400 cursor-not-allowed":"text-green-600 hover:underline"}`,onClick:s=>{t.loans?.length>=3&&(s.preventDefault(),alert("‚ö†Ô∏è This customer already has 3 active or pending loans."))},children:"Create Loan"}),e.jsx("span",{onClick:()=>j(t.id,t.status),className:`cursor-pointer ${t.status==="active"&&t.loans?.some(s=>s.status!=="paid"&&s.amount_remaining>0)?"text-gray-400 cursor-not-allowed":"text-blue-600 hover:underline"}`,children:t.status==="active"?"Mark Inactive":t.status==="inactive"?"Reactivate":"‚Äî"}),e.jsx("span",{onClick:()=>b(t.id,t.status,a),className:`cursor-pointer ${t.status==="suspended"?"text-green-600 hover:underline":a?"text-gray-400 cursor-not-allowed":"text-red-600 hover:underline"}`,children:t.status==="suspended"?"Reactivate":"Suspend"})]})]})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-6 text-gray-600",children:"No customers found."})})})]})})]})]})}export{A as default};
