import{u as I,r,j as e,H as X,a as w}from"./app-Cv3QELsD.js";import{A as G,F as J,a as Q,b as V,c as W,d as T,e as Y,f as Z,g as ee,h as se,i as te}from"./AuthenticatedLayout-B0rF1LC0.js";/* empty css            */import"./transition-2rVswJNR.js";function oe(){const{auth:ae,stats:d={},flash:m={},basePath:n,backups:u=[]}=I().props,[l,c]=r.useState(null),[o,N]=r.useState(null),[P,p]=r.useState(!1),[k,$]=r.useState(null),[v,E]=r.useState("superadmin_only"),[h,f]=r.useState(u),[S,_]=r.useState(null),[z,b]=r.useState(!1),[g,C]=r.useState(null),[M,y]=r.useState(!1),[j,B]=r.useState(""),a=(s,t="info")=>{N({message:s,type:t}),setTimeout(()=>N(null),4e3)};r.useEffect(()=>{m?.success&&a(m.success,"success"),m?.error&&a(m.error,"error")},[m]);const i=async()=>{try{const t=await(await fetch(route(`${n}.system.listBackups`),{credentials:"same-origin"})).json();console.log("ðŸ§¾ API backups response:",t),f(t.backups||[])}catch{a("Failed to load backups.","error")}},q=async()=>{c("refresh"),await i(),c(null),a("âœ… Backups refreshed.","success")},L=async()=>{c("preview");try{const t=await(await fetch(route(`${n}.system.previewReset`),{credentials:"same-origin"})).json();_(t.stats),a("âœ… Preview updated.","success")}catch{a("âŒ Could not preview data.","error")}finally{c(null)}},R=async s=>{s?.preventDefault(),c("backup");try{const t=document.querySelector('meta[name="csrf-token"]')?.content,x=await(await fetch(route(`${n}.system.backup`),{method:"POST",headers:{"X-CSRF-TOKEN":t,Accept:"application/json"},credentials:"include"})).json();x.success?(a(x.message||"âœ… Backup completed successfully.","success"),await i(),f(x.backups||[])):a(x.message||"âŒ Backup failed.","error")}catch(t){console.error("âŒ Backup error:",t),a("âŒ Backup failed to execute.","error")}finally{c(null)}},O=s=>{C(s),b(!0)},U=()=>{g&&(b(!1),c("delete"),w.delete(route(`${n}.system.deleteBackup`,g),{preserveScroll:!0,onSuccess:()=>{a("ðŸ—‘ Backup deleted successfully.","success"),i()},onError:()=>a("âŒ Failed to delete backup.","error"),onFinish:()=>{C(null),c(null)}}))},H=()=>{B(""),y(!0),i()},K=()=>{if(!j){a("Please select a backup file to restore.","error");return}y(!1),c("restore"),w.post(route(`${n}.system.restore`),{file:j},{preserveScroll:!0,onSuccess:()=>a("âœ… Database restored successfully.","success"),onError:()=>a("âŒ Restore failed.","error"),onFinish:()=>c(null)})},F=(s,t)=>{p(!1),c(s);const A=s==="reset"?{keep:v}:{};w.post(route(`${n}.${t}`),A,{preserveScroll:!0,onFinish:()=>c(null),onSuccess:()=>{a(`${s} completed successfully.`,"success"),s==="backup"&&i()},onError:()=>a(`${s} failed.`,"error")})},D=(s,t)=>{s==="reset"?($({type:s,routeName:t}),p(!0)):s==="restore"?H():s==="backup"?R():F(s,t)};return r.useEffect(()=>{i()},[]),r.useEffect(()=>{u&&u.length>0&&f(u)},[u]),e.jsxs(G,{header:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"System Control"}),children:[e.jsx(X,{title:"System Control"}),o&&e.jsx("div",{className:`fixed top-5 right-5 px-4 py-3 rounded-md shadow-md text-white z-50 ${o.type==="success"?"bg-green-600":o.type==="error"?"bg-red-600":"bg-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[o.type==="success"&&e.jsx(J,{}),o.type==="error"&&e.jsx(Q,{}),e.jsx("span",{children:o.message})]})}),P&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md max-w-md w-full p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Reset"}),e.jsx("p",{className:"mt-2 text-gray-600 text-sm",children:"This action will delete most data and cannot be undone."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Keep which users?"}),e.jsxs("select",{value:v,onChange:s=>E(s.target.value),className:"w-full border border-gray-300 rounded-md px-2 py-1 focus:ring-gray-400 focus:border-gray-400",children:[e.jsx("option",{value:"superadmin_only",children:"Superadmin Only"}),e.jsx("option",{value:"keep_admins",children:"Superadmin + Admins"}),e.jsx("option",{value:"keep_all_staff",children:"Superadmin + Admins + Staff"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md font-semibold",children:"Cancel"}),e.jsx("button",{onClick:()=>F(k.type,k.routeName),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-semibold",children:"Confirm Reset"})]})]})}),z&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md max-w-md w-full p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Backup"}),e.jsxs("p",{className:"mt-2 text-gray-600 text-sm",children:["Are you sure you want to delete"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:g})," ","permanently?"]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md font-semibold",children:"Cancel"}),e.jsx("button",{onClick:U,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-semibold",children:"Delete"})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md max-w-md w-full p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Restore Backup"}),e.jsx("p",{className:"mt-2 text-gray-600 text-sm",children:"Choose which backup file you want to restore."}),e.jsxs("select",{className:"mt-4 w-full border border-gray-300 rounded-md px-2 py-2 text-sm",value:j,onChange:s=>B(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select Backup File --"}),h.map(s=>e.jsxs("option",{value:s.file,children:[s.file," (",s.size,")"]},s.file))]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>y(!1),className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md font-semibold",children:"Cancel"}),e.jsx("button",{onClick:K,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-semibold",children:"Restore"})]})]})}),e.jsxs("div",{className:"py-6 max-w-5xl mx-auto space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Users",value:d.users},{label:"Customers",value:d.customers},{label:"Loans",value:d.loans},{label:"Payments",value:d.payments}].map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wide",children:s.label}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-1",children:s.value})]},s.label))}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:e.jsxs("p",{className:"text-gray-800 text-sm font-medium",children:["Last Backup:"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:d.last_backup||"No backups yet"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[e.jsxs("button",{type:"button",onClick:s=>R(s),disabled:l==="backup",className:"flex items-center gap-2 px-6 py-2.5 bg-gray-800 hover:bg-gray-900 text-white font-semibold rounded-md transition disabled:opacity-50",children:[e.jsx(V,{}),e.jsx("span",{children:l==="backup"?"Backing up...":"Backup Data"})]}),e.jsxs("button",{onClick:()=>D("restore","system.restore"),disabled:l==="restore",className:"flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition disabled:opacity-50",children:[e.jsx(W,{}),e.jsx("span",{children:l==="restore"?"Restoring...":"Restore Backup"})]}),e.jsxs("button",{onClick:()=>D("reset","system.reset"),disabled:l==="reset",className:"flex items-center gap-2 px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-md transition disabled:opacity-50",children:[e.jsx(T,{}),e.jsx("span",{children:l==="reset"?"Resetting...":"Reset All Data"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Y,{})," Preview Data Before Reset"]}),e.jsx("button",{onClick:L,disabled:l==="preview",className:"px-3 py-1.5 bg-gray-800 hover:bg-gray-900 text-white font-semibold rounded-md text-sm disabled:opacity-50",children:l==="preview"?"Loading...":"Refresh"})]}),S?e.jsx("ul",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:Object.entries(S).map(([s,t])=>e.jsxs("li",{className:"bg-gray-50 border border-gray-200 rounded p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-medium",children:s}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:t})]},s))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"Click refresh to view data preview."})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Z,{})," Backup Files"]}),e.jsxs("button",{onClick:q,disabled:l==="refresh",className:"flex items-center gap-2 px-3 py-1.5 bg-gray-800 hover:bg-gray-900 text-white font-semibold rounded-md text-sm disabled:opacity-50",children:[e.jsx(ee,{className:l==="refresh"?"animate-spin":""}),e.jsx("span",{children:l==="refresh"?"Refreshing...":"Refresh"})]})]}),h.length?e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-700 font-medium",children:[e.jsx("th",{className:"py-2 text-left",children:"File"}),e.jsx("th",{className:"py-2 text-left",children:"Size"}),e.jsx("th",{className:"py-2 text-left",children:"Date"}),e.jsx("th",{className:"py-2 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:h.map((s,t)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2",children:s.file}),e.jsx("td",{className:"py-2",children:s.size}),e.jsx("td",{className:"py-2",children:s.date}),e.jsxs("td",{className:"py-2 flex gap-2",children:[e.jsxs("a",{href:route(`${n}.system.download`,s.file),className:"inline-flex items-center gap-1 px-3 py-1 bg-gray-800 hover:bg-gray-900 text-white font-semibold rounded text-sm",children:[e.jsx(se,{}),e.jsx("span",{children:"Download"})]}),e.jsxs("button",{onClick:()=>O(s.file),className:"inline-flex items-center gap-1 px-3 py-1 bg-red-600 hover:bg-red-700 text-white font-semibold rounded text-sm",children:[e.jsx(T,{}),e.jsx("span",{children:"Delete"})]})]})]},t))})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No backups found."}),e.jsxs("form",{method:"POST",action:route(`${n}.system.upload`),encType:"multipart/form-data",className:"mt-4 border-t pt-4",children:[e.jsx("p",{className:"text-gray-800 text-sm mb-2 font-semibold",children:"Upload Backup (.sqlite or .sql)"}),e.jsx("input",{type:"file",name:"backup_file",accept:".sqlite,.sql",required:!0,className:"block w-full text-sm text-gray-700 mb-2"}),e.jsx("button",{type:"submit",className:"px-3 py-2 bg-gray-800 hover:bg-gray-900 text-white font-semibold rounded-md text-sm",children:"Upload & Restore"})]})]})]}),l&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-700 font-medium",children:[e.jsx(te,{className:"animate-spin text-lg"}),e.jsxs("span",{children:["Processing ",l,"..."]})]})})]})]})}export{oe as default};
