import{u as R,j as e,r as x,b as w,H as F,L as M,a as b}from"./app-Cv3QELsD.js";import{A as O}from"./AuthenticatedLayout-B0rF1LC0.js";/* empty css            */import"./transition-2rVswJNR.js";const d=n=>`â‚µ${Number(n??0).toFixed(2)}`,u=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"â€”",_=document.createElement("style");_.textContent=`
@keyframes fadeInOut {
  0% { opacity: 0; transform: translateY(-10px); }
  10%, 80% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-10px); }
}
.animate-fade-in-out {
  animation: fadeInOut 3s ease-in-out forwards;
}
`;document.head.appendChild(_);function q(){const{loan:n={},auth:s={},flash:l={},csrf_token:m,basePath:o="admin"}=R().props;if(!n||Object.keys(n).length===0)return e.jsx("div",{className:"text-center py-20 text-red-600 font-semibold",children:"âš ï¸ Loan not found or data not loaded."});const[t,B]=x.useState(n),[C,h]=x.useState(!1),[f,p]=x.useState(null),S=["admin","staff","superadmin"].includes(s?.user?.role),{data:g,setData:j,post:v,processing:P,errors:D,reset:$}=w({amount:"",paid_at:new Date().toISOString().split("T")[0],reference:"",note:""}),k=a=>{a.preventDefault();const r=parseFloat(g.amount),i=parseFloat(t.amount_remaining||0);if(r>i){alert(`âš ï¸ Payment exceeds remaining balance (${d(i)})`);return}v(route(`${o}.loans.payment`,t.id),{data:g,preserveScroll:!0,onSuccess:()=>{$(),h(!1),b.reload({only:["loan"]})}})};x.useEffect(()=>{if(l?.success||l?.error){const a=setTimeout(()=>{window.history.replaceState(null,"",window.location.pathname)},3500);return()=>clearTimeout(a)}},[l]);const{delete:L}=w({}),A=()=>{p({title:"Activate Loan",message:"Are you sure you want to activate this loan? Once activated, it becomes live and visible to the customer.",confirmLabel:"Activate",confirmTheme:"green",onConfirm:()=>{v(route(`${o}.loans.activate`,t.id),{preserveScroll:!0,onSuccess:()=>{b.reload({only:["loan"]}),setTimeout(()=>window.location.reload(),800)}})}})},T=()=>{p({title:"Delete Loan",message:"Do you really want to delete this loan? This action cannot be undone.",confirmLabel:"Delete",confirmTheme:"red",onConfirm:()=>{L(route(`${o}.loans.deactivate`,t.id),{onSuccess:()=>b.visit(route(`${o}.loans.index`))})}})};return e.jsxs(O,{header:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Loan Details"}),children:[e.jsx(F,{title:`Loan #${t.id}`}),l?.success&&e.jsx("div",{className:"fixed top-5 right-5 z-50 bg-green-600 text-white px-5 py-3 rounded-lg shadow-lg animate-fade-in-out",children:l.success}),l?.error&&e.jsx("div",{className:"fixed top-5 right-5 z-50 bg-red-600 text-white px-5 py-3 rounded-lg shadow-lg animate-fade-in-out",children:l.error}),e.jsxs("div",{className:"py-8 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(M,{href:route(`${o}.loans.index`),className:"text-gray-600 hover:underline",children:"â† Back to Loans"}),t.status==="pending"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:A,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"âœ… Activate"}),e.jsx("button",{onClick:T,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"âŒ Delete"})]})]}),t.status==="active"&&e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Make a Payment"}),(()=>{const a=t.loan_schedules?.find(N=>!N.is_paid&&Number(N.remaining_amount??0)>0)||null,r=a?Number(a.remaining_amount||0):0,i=r<=.009;return e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("form",{method:"POST",action:route(`${o}.paystack.initialize`),className:"flex items-center gap-3",children:[e.jsx("input",{type:"hidden",name:"_token",value:m}),e.jsx("input",{type:"hidden",name:"email",value:t.customer?.email||"test@example.com"}),e.jsx("input",{type:"hidden",name:"loan_id",value:t.id}),e.jsx("input",{type:"hidden",name:"amount",value:r}),e.jsxs("select",{name:"method",className:"border rounded p-2 bg-white text-gray-800",children:[e.jsx("option",{value:"card",children:"ðŸ’³ Card"}),e.jsx("option",{value:"mobile_money",children:"ðŸ“± Mobile Money"})]}),e.jsxs("button",{type:"submit",disabled:i,className:`px-4 py-2 rounded text-white ${i?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,title:i?"Nothing due in the current installment.":void 0,children:["Pay ",d(r)]})]}),S&&e.jsxs("button",{onClick:()=>{j("amount",r.toFixed(2)),h(!0)},disabled:i,className:`px-4 py-2 rounded text-white ${i?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,title:i?"Nothing due in the current installment.":void 0,children:["ðŸ’µ Record Cash Payment (",d(r),")"]})]})})()]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Payment History"}),t.payments?.length?e.jsxs("table",{className:"min-w-full text-sm border border-gray-100",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsx("tr",{children:["Date","Amount","Method","Reference","Note","Received By"].map(a=>e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:a},a))})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:[...t.payments||[]].sort((a,r)=>new Date(r.paid_at)-new Date(a.paid_at)).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:u(a.paid_at)}),e.jsx("td",{className:"px-4 py-2",children:d(a.amount)}),e.jsx("td",{className:"px-4 py-2 capitalize",children:a.payment_method||"â€”"}),e.jsx("td",{className:"px-4 py-2",children:a.reference||"â€”"}),e.jsx("td",{className:"px-4 py-2",children:a.note||"â€”"}),e.jsx("td",{className:"px-4 py-2",children:a.receivedByUser?.name||s.user?.name||"â€”"})]},a.id))})]}):e.jsx("p",{className:"text-gray-600 italic",children:"No payments recorded yet."})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Client Name",value:t.client_name}),e.jsx(c,{label:"Created By",value:t.created_by?`${t.created_by.name} (${t.created_by.email})`:"â€”"}),e.jsx(c,{label:"Status",value:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${t.status==="active"?"bg-blue-100 text-blue-700":t.status==="paid"?"bg-green-100 text-green-700":t.status==="overdue"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:t.status?.toUpperCase()})}),e.jsx(c,{label:"Amount",value:d(t.amount)}),e.jsx(c,{label:"Interest Rate",value:`${t.interest_rate}%`}),e.jsx(c,{label:"Term",value:`${t.term_months} month(s)`}),e.jsx(c,{label:"Start Date",value:u(t.start_date)}),e.jsx(c,{label:"Due Date",value:u(t.due_date)}),e.jsx(c,{label:"Totals",value:e.jsxs(e.Fragment,{children:["Paid:"," ",e.jsx("span",{className:"text-green-600 font-semibold",children:d(t.amount_paid)})," ","Â· Remaining:"," ",e.jsx("span",{className:"text-red-600 font-semibold",children:d(t.amount_remaining)})]})})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Monthly Payment Schedule"}),t.loan_schedules?.length?e.jsxs("table",{className:"min-w-full text-sm border border-gray-100",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsx("tr",{children:["Payment","Amount (â‚µ)","Amount Paid (â‚µ)","Remainder (â‚µ)","Due Date","Status"].map(a=>e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:a},a))})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t.loan_schedules.map(a=>{let r="Pending",i="bg-yellow-100 text-yellow-700";return a.is_paid||a.remaining_amount<=.009?(r="Cleared âœ…",i="bg-green-100 text-green-700"):a.remaining_amount<a.amount&&a.remaining_amount>.009&&(r=`Partial â€” â‚µ${a.remaining_amount.toFixed(2)} left`,i="bg-orange-100 text-orange-700"),e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-2",children:[a.payment_number,["st","nd","rd"][a.payment_number-1]||"th"," ","Payment"]}),e.jsx("td",{className:"px-4 py-2 text-gray-800 font-semibold",children:d(a.amount)}),e.jsx("td",{className:"px-4 py-2 text-blue-700 font-semibold",children:d(a.amount_paid)}),e.jsx("td",{className:"px-4 py-2 text-red-600 font-semibold",children:d(a.remaining_amount)}),e.jsx("td",{className:"px-4 py-2",children:u(a.due_date)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`${i} px-2 py-1 rounded text-xs font-semibold whitespace-nowrap`,children:r})})]},a.id)})})]}):e.jsx("p",{className:"text-gray-600 italic",children:"No schedule available yet."})]}),C&&e.jsx(z,{data:g,setData:j,errors:D,processing:P,onCancel:()=>h(!1),onSubmit:k}),f&&e.jsx(I,{action:f,onCancel:()=>p(null)})]})]})}function c({label:n,value:s}){return e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:n}),e.jsx("p",{className:"text-lg text-gray-800 font-medium",children:s})]})}function z({data:n,setData:s,processing:l,onCancel:m,onSubmit:o}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-lg bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Record Cash Payment"}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx(y,{label:"Amount (â‚µ)",type:"number",value:n.amount,onChange:t=>s("amount",t.target.value),required:!0}),e.jsx(y,{label:"Payment Date",type:"date",value:n.paid_at,onChange:t=>s("paid_at",t.target.value),required:!0}),e.jsx(y,{label:"Reference (optional)",type:"text",value:n.reference,onChange:t=>s("reference",t.target.value),placeholder:"Txn ID or receipt number"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Note (optional)"}),e.jsx("textarea",{rows:"3",value:n.note,onChange:t=>s("note",t.target.value),className:"mt-1 w-full border rounded-md p-2 text-gray-800"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 rounded bg-gray-200 text-gray-900 font-semibold hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:l?"Saving...":"Save Payment"})]})]})]})})}function y({label:n,type:s="text",value:l,onChange:m,required:o}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:n}),e.jsx("input",{type:s,value:l,onChange:m,required:o,className:"mt-1 w-full border rounded-md p-2 text-gray-800 bg-white"})]})}function I({action:n,onCancel:s}){if(!n)return null;const l=n.confirmTheme==="red"?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:n.title}),e.jsx("p",{className:"text-gray-700 mb-6",children:n.message}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 rounded bg-gray-200 text-gray-900 font-semibold hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:()=>{n.onConfirm?.(),s()},className:`px-4 py-2 rounded text-white font-semibold ${l}`,children:n.confirmLabel||"Confirm"})]})]})})}export{q as default};
