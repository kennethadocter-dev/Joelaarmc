import{r as l,j as e,u as S,a as g,H as A,L as f}from"./app-Cv3QELsD.js";import{A as R}from"./AuthenticatedLayout-B0rF1LC0.js";import{p as C}from"./printSection-MIQ23R94.js";/* empty css            */import"./transition-2rVswJNR.js";function _({message:s,type:a="success",onClose:n}){const[i,r]=l.useState(!0);return l.useEffect(()=>{const d=setTimeout(()=>{r(!1),n&&n()},3e3);return()=>clearTimeout(d)},[]),!i||!s?null:e.jsx("div",{className:`fixed top-5 right-5 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-semibold transition-opacity ${a==="error"?"bg-red-600":a==="warning"?"bg-yellow-500":"bg-green-600"}`,children:s})}function L({open:s,title:a,message:n,onConfirm:i,onCancel:r}){return s?e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-[90%] max-w-sm p-6 text-center border border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:a||"Are you sure?"}),e.jsx("p",{className:"text-gray-600 mt-2",children:n}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx("button",{onClick:r,className:"px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{onClick:i,className:"px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Confirm"})]})]})}):null}const F=s=>`â‚µ${Number(s??0).toFixed(2)}`,b=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"â€”";function I(){const{loans:s=[],failures:a=[],filters:n={},auth:i={},basePath:r="admin"}=S().props,d=i?.user||{},[m,j]=l.useState(n.q||""),x=l.useRef(null),[u,o]=l.useState({message:"",type:"success"}),[c,p]=l.useState({open:!1,action:null,loanId:null}),N=["admin","staff","officer","superadmin"].includes(d?.role)||d?.is_super_admin;l.useEffect(()=>{const t=setTimeout(()=>{g.get(route(`${r}.reports.index`),{q:m||void 0},{preserveScroll:!0,preserveState:!0,replace:!0})},400);return()=>clearTimeout(t)},[m]);const w=()=>{x.current?C(x.current,"Loan Reports"):o({message:"âš ï¸ Table section not found!",type:"error"})},y=(t,h=null)=>{p({open:!0,action:t,loanId:h})},v=()=>{const{action:t,loanId:h}=c;p({open:!1,action:null,loanId:null}),t==="retry"?g.post(route(`${r}.reports.sendAgreement`,h),{},{preserveScroll:!0,onSuccess:()=>o({message:"âœ… Loan Agreement email resent successfully!",type:"success"}),onError:()=>o({message:"âŒ Failed to resend Loan Agreement email.",type:"error"})}):t==="clear"&&g.delete(route(`${r}.reports.clearFailures`),{preserveScroll:!0,onSuccess:()=>o({message:"ðŸ§¹ All email failures cleared successfully!",type:"success"}),onError:()=>o({message:"âŒ Failed to clear failures. Please try again.",type:"error"})})};return e.jsxs(R,{header:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Reports Dashboard"}),children:[e.jsx(A,{title:"Reports"}),u.message&&e.jsx(_,{message:u.message,type:u.type,onClose:()=>o({message:"",type:"success"})}),e.jsx(L,{open:c.open,title:c.action==="clear"?"Clear All Failures?":"Retry Sending Email?",message:c.action==="clear"?"Are you sure you want to clear all email failure logs?":"Are you sure you want to retry sending this Loan Agreement email?",onConfirm:v,onCancel:()=>p({open:!1,action:null,loanId:null})}),e.jsxs("div",{className:"py-8 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 items-start md:items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-gray-800 text-lg",children:"All Loans"}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto",children:[e.jsx("input",{value:m,onChange:t=>j(t.target.value),placeholder:"Search by client name or loan IDâ€¦",className:"border border-gray-300 rounded px-3 py-2 w-full md:w-80 bg-white text-gray-900 placeholder-gray-500 focus:ring-blue-500 focus:border-blue-500 shadow-sm"}),e.jsx("button",{onClick:w,className:"px-4 py-2 rounded bg-gray-800 text-white hover:bg-black transition shadow",children:"ðŸ–¨ï¸ Print Report"})]})]}),a&&a.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-300 p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-red-700 font-bold text-sm mb-2",children:"âš ï¸ Recent Email Failures"}),e.jsx("ul",{className:"divide-y divide-red-200 mb-3",children:a.map(t=>e.jsxs("li",{className:"py-2 flex flex-col md:flex-row md:items-center md:justify-between text-sm text-red-700",children:[e.jsxs("div",{className:"space-y-1 md:space-y-0",children:[e.jsxs("div",{children:["Failed to send ",e.jsx("b",{children:t.subject})," to"," ",e.jsx("b",{children:t.recipient})]}),e.jsxs("div",{className:"text-xs text-red-500 truncate",children:["Reason: ",t.error_message]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.failed_at).toLocaleString()})]}),e.jsx("button",{onClick:()=>y("retry",t.loan_id),className:"mt-2 md:mt-0 px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-xs font-semibold shadow-sm transition",children:"ðŸ” Retry Send"})]},t.id))}),e.jsx("button",{onClick:()=>y("clear"),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-xs font-semibold shadow-sm transition",children:"ðŸ§¹ Clear All Failures"})]}),e.jsxs("div",{ref:x,className:"overflow-x-auto bg-white rounded-lg shadow",children:[e.jsx("h2",{className:"text-center text-lg font-bold my-4 bg-gray-800 text-white py-2 rounded-md shadow-sm",children:"Loan Reports"}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-800",children:e.jsx("tr",{children:["Loan #","Client","Amount","Rate","Term","Start","Due","Status","Actions"].map(t=>e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:s.length?s.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsxs("td",{className:"px-4 py-3 text-sm",children:["#",t.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.client_name||t.customer?.full_name||"â€”"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:F(t.amount)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[t.interest_rate??0,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[t.term_months??0," months"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b(t.start_date)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b(t.due_date)}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="paid"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":t.status==="overdue"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:t.status})}),e.jsxs("td",{className:"px-4 py-3 text-sm flex flex-wrap gap-2",children:[e.jsx(f,{href:route(`${r}.reports.show`,t.id),className:"text-blue-600 hover:underline",children:"View Full Report"}),N&&e.jsx(f,{href:route(`${r}.reports.sendAgreement`,t.id),method:"post",as:"button",className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded font-semibold transition",children:"Send Agreement"})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"text-center py-6 text-gray-600",children:"No loans found."})})})]})]})]})]})}export{I as default};
