import{u as M,r as f,b as F,j as e,H as I,L as _,a as k}from"./app-CsPuMaPE.js";import{A as D}from"./AuthenticatedLayout-DLvna0tA.js";/* empty css            */import"./transition-Bs_woZCa.js";function P(d,i,l,o){if(!d||!i||!l||!o)return[];const c=parseFloat(d),a=parseInt(l,10),b={1:1.2,2:1.31,3:1.425,4:1.56,5:1.67,6:1.83}[a]??1+i/100,h=c*b,j=r=>Math.ceil(r*100)/100,t=h/a,n=[];for(let r=1;r<a;r++){const m=j(t),g=new Date(o);g.setMonth(g.getMonth()+r),n.push({month:r,label:r===1?"1st Payment":r===2?"2nd Payment":r===3?"3rd Payment":`${r}th Payment`,installment:m,due_date:g.toISOString().split("T")[0]})}const v=n.reduce((r,m)=>r+m.installment,0),y=Math.round((h-v)*100)/100,p=new Date(o);return p.setMonth(p.getMonth()+a),n.push({month:a,label:`${a}th Payment`,installment:y,due_date:p.toISOString().split("T")[0]}),n}function E(){const{prefill_client_name:d="",prefill_customer_id:i="",defaults:l={},suggested_amount:o,auth:c,flash:a,basePath:x="admin"}=M().props,b=c?.user,[h,j]=f.useState(!0),{data:t,setData:n,post:v,processing:y,reset:p,errors:r}=F({user_id:b?.id||"",customer_id:i||"",client_name:d||"",amount:o?parseFloat(o):"",interest_rate:l?.interest_rate?parseFloat(l.interest_rate):"",term_months:l?.term_months?parseInt(l.term_months,10):1,start_date:new Date().toISOString().split("T")[0],due_date:"",notes:""});f.useEffect(()=>{if(t.start_date&&t.term_months){const s=new Date(t.start_date);s.setMonth(s.getMonth()+parseInt(t.term_months,10)),n("due_date",s.toISOString().split("T")[0])}},[t.start_date,t.term_months]);const m=f.useMemo(()=>!t.amount||!t.interest_rate||!t.term_months?[]:P(t.amount,t.interest_rate,t.term_months,t.start_date),[t.amount,t.interest_rate,t.term_months,t.start_date]),g=m.reduce((s,C)=>s+C.installment,0),N=m.length?m[0].installment:0,w=s=>{if(s.preventDefault(),!t.customer_id){alert("âš ï¸ Missing customer. Please select a client first.");return}v(route(`${x}.loans.store`),{preserveScroll:!0,onSuccess:()=>{p(),k.visit(route(`${x}.loans.index`))}})},S=!i||!d;return e.jsxs(D,{header:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Create Loan"}),children:[e.jsx(I,{title:"Create Loan"}),e.jsxs("div",{className:"py-8 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8",children:[a?.success&&e.jsx("div",{className:"mb-4 px-4 py-2 bg-green-100 text-green-800 rounded shadow",children:a.success}),a?.error&&e.jsx("div",{className:"mb-4 px-4 py-2 bg-red-100 text-red-800 rounded shadow",children:a.error}),S?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 p-6 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2",children:"Client Not Selected"}),e.jsx("p",{className:"text-yellow-700",children:"Please select or register a customer before creating a loan."}),e.jsx("div",{className:"mt-4",children:e.jsx(_,{href:route(`${x}.customers.index`),className:"inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"â† Back to Customers"})})]}):e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[e.jsx("div",{className:"mb-5 flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>alert(`Currently creating loan for ${t.client_name}`),className:"px-4 py-2 bg-gray-800 text-white rounded-md shadow hover:bg-black transition",children:["ðŸ’¡ Creating loan for: ",t.client_name]})}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-100 rounded-lg border border-gray-300 grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Due"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700",children:["â‚µ",Math.ceil(g).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly Payment"}),e.jsxs("p",{className:"text-xl font-bold text-green-700",children:["â‚µ",Math.ceil(N).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Interest Rate"}),e.jsxs("p",{className:"text-xl font-bold text-indigo-700",children:[t.interest_rate||0,"%"]})]})]}),e.jsxs("form",{onSubmit:w,className:"space-y-5",children:[e.jsx(u,{label:"Borrower (Staff)",value:b?.name||"",readOnly:!0}),e.jsx(u,{label:"Client Name",value:t.client_name,readOnly:!0}),e.jsx("input",{type:"hidden",name:"customer_id",value:t.customer_id}),e.jsx(u,{label:"Amount (â‚µ)",type:"number",value:t.amount,onChange:s=>n("amount",s.target.value===""?"":parseFloat(s.target.value)),required:!0}),e.jsx(u,{label:"Interest Rate (%)",type:"number",value:t.interest_rate,onChange:s=>n("interest_rate",s.target.value===""?"":parseFloat(s.target.value)),required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx($,{label:"Term (months)",value:t.term_months,onChange:s=>n("term_months",parseInt(s.target.value,10)),options:[1,2,3,4,5,6].map(s=>({value:s,label:`${s}`}))}),e.jsx(u,{label:"Start Date",type:"date",value:t.start_date,onChange:s=>n("start_date",s.target.value),required:!0}),e.jsx(u,{label:"Final Due Date",type:"date",value:t.due_date,readOnly:!0})]}),e.jsxs("div",{className:"border-t pt-5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Monthly Payment Schedule"}),e.jsx("button",{type:"button",onClick:()=>j(s=>!s),className:"force-white bg-gray-800 px-3 py-1.5 rounded-md text-sm hover:bg-gray-900 transition",children:h?"Hide Schedule â–²":"Show Schedule â–¼"})]}),h&&e.jsx(e.Fragment,{children:m.length?e.jsx("div",{className:"overflow-x-auto mt-3",children:e.jsxs("table",{className:"min-w-full text-sm bg-gray-50 rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-800",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Payment"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Due Date"})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:s.label}),e.jsxs("td",{className:"px-4 py-2",children:["â‚µ",s.installment.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2",children:s.due_date})]},s.month))})]})}):e.jsx("p",{className:"text-gray-600 mt-3",children:"Enter amount, rate, and term to preview schedule."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"Notes (optional)"}),e.jsx("textarea",{rows:"3",value:t.notes,onChange:s=>n("notes",s.target.value),className:"w-full border rounded p-2 text-gray-800",placeholder:"Any special conditions..."})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx(_,{href:route(`${x}.loans.index`),className:"text-gray-600 hover:underline",children:"â† Back to Loans"}),e.jsx("button",{type:"submit",disabled:y,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:y?"Saving...":"Create Loan"})]})]})]})]})]})}function u({label:d,value:i,onChange:l,type:o="text",required:c,readOnly:a}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:d}),e.jsx("input",{type:o,value:i,onChange:l,required:c,readOnly:a,className:`mt-1 block w-full rounded-md border-gray-300 bg-white text-gray-900 ${a?"bg-gray-100 text-gray-700 cursor-not-allowed":""}`})]})}function $({label:d,value:i,onChange:l,options:o}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700",children:d}),e.jsx("select",{value:i,onChange:l,className:"mt-1 block w-full rounded-md border-gray-300 bg-white text-gray-900",children:o.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]})}export{E as default};
